<!DOCTYPE html>
<html><head><meta charset=utf-8 ><title>Async ESP FS WebServer</title><meta content="width=device-width, initial-scale=1" name=viewport >
<style>.topnav a,details,header,main,summary{display:block}*,input[type=checkbox]{box-sizing:border-box}.ctn,.ctn:after{clear:both}.ctn,.d-modal{box-shadow:rgba(0,0,0,.24) 0 3px 8px}#svg-logo,.btn,.d-modal-close,.show-hide-wrap,.toggle{cursor:pointer}.inputfile{width:10px;height:10px;opacity:0;overflow:hidden;position:absolute;z-index:-1}.loader,.loader:after,.loader:before{border-radius:50%;width:2em;height:2em;-webkit-animation:1.8s ease-in-out infinite load7;animation:1.8s ease-in-out infinite load7}.loader{color:#333;font-size:10px;margin-left:auto;margin-right:auto;position:relative;text-indent:-9999em;z-index:999;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation-delay:-.16s;animation-delay:-.16s}.loader:after,.loader:before{content:'';position:absolute;top:0}.loader:before{left:-4.5em;-webkit-animation-delay:-.32s;animation-delay:-.32s}.loader:after{left:4.5em}.d-modal,.d-modal-close{display:flex;position:absolute}.d-modal{border-radius:10px;border-style:solid;border-width:1px;border-color:#3333336e;background-color:hsl(0deg 2% 57% / 95%);left:50%;max-width:90%;top:40%;transform:translate(-50%,-50%);width:30em;text-align:left;max-height:90vh;flex-direction:column;z-index:999}.heading-2,.lbl-wifi,.topnav a,footer{text-align:center}.d-modal-close{align-items:center;color:#111827;height:4.5em;justify-content:center;right:0;top:0;width:4.5em}.d-modal-title{color:#111827;padding:1.5em 2em;position:relative;width:calc(100% - 4.5em)}.d-modal-content{border-top:1px solid #e0e0e0;padding:2em;overflow:auto}.topnav{background-color:#333;overflow:hidden;width:fit-content;float:right;border-radius:5px;position:absolute;bottom:5px;right:20px}.ctn,.input-label{position:relative}.topnav a{float:left;color:#f2f2f2;padding:5px 10px;text-decoration:none;font-size:16px}.topnav a:hover{filter:brightness(55%);cursor:pointer}.topnav a.active{background-color:#56c080;color:#fff}.hide,.show-hide.w--current,.topnav .icon{display:none}html{font-family:sans-serif}.table{width:90%;margin:auto;border-collapse:collapse;border-spacing:0}a{background-color:transparent}a:active,a:hover{outline:0}b{font-weight:700}h1{font-size:38px}h2{font-size:24px}hr{padding:0}.input-label{color:#015293;left:8px;bottom:-7px;z-index:2;display:inline-block;margin-bottom:0;padding-right:7px;padding-left:6px;border:1px solid #dcdce5;border-radius:6px;background-color:#fff;font-size:13.5px;line-height:17px;font-weight:500}input[type=checkbox]{padding:0}input[type=number],input[type=password],input[type=text],select{height:40px;width:100%;padding-top:10px;padding-left:20px;border:1px solid #ccc;border-radius:6px;box-shadow:0 1px 2px 0 rgba(220,220,230,.5);transition:border-color .2s,box-shadow .2s;font-size:16px}.body,.ctn{border-radius:10px}input[type=file]{width:50%;padding:10px}input::placeholder{color:#5e5e5e}input:hover{border-color:rgba(0,0,0,.8);box-shadow:0 1px 4px 0 rgba(220,220,229,.9)}input:focus,select:focus{border-color:#3898ec;outline:0}.ctn:after,.ctn:before{content:" ";display:table;grid-column-start:1;grid-row-start:1;grid-column-end:2;grid-row-end:2}.ctn{display:block;max-width:940px;margin:10px auto;padding:10px 40px;flex-direction:row;justify-content:center;flex-wrap:wrap;align-items:center;align-content:space-around;border-style:solid;border-width:1px;border-color:#3333336e;background-color:hsla(0,0%,100%,.8)}.heading,.svg{margin-right:10px}.body,.form,.heading-2{padding-right:20px;padding-left:20px}.btn,.title{justify-content:center}footer{font-size:12px;margin:40px}#about{color:#d3d3d3}.body{background-clip:border-box}.title{display:flex;float:left}.heading-2{font-weight:400}.form{position:static}.btn{display:inline-flex;padding:10px 15px;background-color:#3898ec;color:#fff;border:0;min-width:40%;border-radius:5px}.btn:hover{filter:brightness(85%)}.btn-bar{display:flex;margin-top:20px;padding:20px;justify-content:center;flex-wrap:wrap;grid-column-gap:30px;grid-row-gap:20px}.tf-wrapper{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;margin-bottom:12px;flex-direction:column;align-items:flex-start}.show-hide{max-width:100%;display:flex;background-color:#fff;font-size:13.5px}.show-hide-wrap{position:absolute;left:auto;top:40%;right:2%;bottom:auto;z-index:4}.svg{display:flex;width:20px}.svg-e{margin-top:5px}.heading{margin-left:10px}.toggle{display:inline-block;padding:5px;width:100%;margin:0 0 18px -8px}.toggle-switch{display:inline-block;background:#ccc;border-radius:16px;width:58px;height:32px;position:relative;vertical-align:middle;transition:background .25s}.toggle-switch:after,.toggle-switch:before{content:""}.toggle-switch:before{display:block;background:linear-gradient(to bottom,#fff 0,#eee 100%);border-radius:50%;box-shadow:0 0 0 1px rgba(0,0,0,.25);width:24px;height:24px;position:absolute;top:4px;left:4px;transition:left .25s}.toggle:hover .toggle-switch:before{background:linear-gradient(to bottom,#fff 0,#fff 100%);box-shadow:0 0 0 1px rgba(0,0,0,.5)}.t-check:checked+.toggle-switch{background:#56c080}.t-check:checked+.toggle-switch:before{left:30px}.t-check{position:absolute;visibility:hidden}.toggle-label{margin-left:5px;position:relative;top:2px}@media screen and (max-width:991px){.ctn,.wifi-connect{padding-right:20px;padding-left:20px}.ctn{position:relative;overflow:visible;max-width:95%;grid-column-gap:10px;grid-row-gap:10px;object-fit:contain}}@media screen and (max-width:767px){.wifi-connect{padding-right:10px;padding-left:10px}}@media screen and (max-width:608px){h1{font-size:30px}.btn-bar{margin-top:20px;flex-direction:column}.topnav{margin-bottom:5px;width:-webkit-fill-available;max-width:60%}.topnav a{padding:5px 20px}.topnav a:not(.active){display:none}.topnav a.icon{float:right;display:block}}@media screen and (max-width:479px){.body{padding-right:2px;padding-left:2px}.form,.heading-2{padding-right:0;padding-left:0}.heading-2{margin-top:10px}.ctn{max-width:100%;padding:0 10px}}/*! CSS Used from: http://192.168.217.87/config/raw-css-fetch.css */pre{font-family:Monaco,Menlo,Consolas,'Courier New',monospace;color:#333;line-height:20px;background-color:#f5f5f5;border:1px solid rgba(0,0,0,.15);border-radius:6px;overflow-y:scroll;min-height:350px;font-size:85%}.select{width:25%;height:40px;padding-top:10px;padding-left:20px;border:1px solid #ccc;border-radius:6px;box-shadow:0 1px 2px 0 rgba(220,220,230,.5)}.body{background-color:#5f9ea0}/*! CSS Used keyframes */@-webkit-keyframes load7{0%,100%,80%{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}@keyframes load7{0%,100%,80%{box-shadow:0 2.5em 0 -1.3em}40%{box-shadow:0 2.5em 0 0}}</style>
</head>
<body class=body> <main id=main-box> <header class="ctn header"> <div class=title> <input type="file" onchange="uploadLogo()" class="inputfile" id="logo-file"> <label for="logo-file" class="svg-button"> <span id=svg-logo title='Click to upload your logo file'></span> </label> <h1 id=name-logo class=heading>Async ESP FS WebServer</h1> </div><div class=topnav id=top-nav> <span id="nav-link"><a id=set-wifi class="a-link active" data-box="wifi-box">WiFi Setup</a></span> <span id="upd-link"><a id=set-update class="a-link" data-box="update-box">Update</a></span> <a class="a-link icon" id=hum-btn> <div class=svg style=margin:-2px> <svg id=svg-menu fill=currentColor viewBox="0 0 20 18"></svg> </div></a> </div></header> <div id=wifi-box class="ctn opt-box"> <h2 class=heading-2>Connect to WiFi</h2> <div style='text-align: center' >ESP mode: <b> <span id=esp-mode></span></b>, IP address: <b> <span id=esp-ip></span></b>, Firmware: <span id=firmware></span> </div><div id=wifi-table class=hide> <hr> <table class=table> <tbody id=wifi-list></tbody> </table> <br></div><div class=wifi-connect> <form class=form> <div class=tf-wrapper> <label for=ssid class=input-label>SSID</label> <input type=text placeholder="Enter your WiFI SSID name" id="ssid"> </div><div class=tf-wrapper> <label for=password class=input-label>Password</label> <div class=show-hide-wrap id=show-hide-password> <a class="show-hide w--current" id=show-pass> <div class=svg><svg class=svg-e id=svg-eye viewBox="0 0 24 24"></svg></div></a> <a class="show-hide" id=hide-pass> <div class=svg><svg class=svg-e id=svg-no-eye viewBox="0 0 24 24"></svg></div></a> </div><input type=password placeholder="Enter your WiFi password" id=password autocomplete=current-password data-ms-member="password"> </div></form> <label class="toggle lbl-wifi"> <span class=toggle-label>Store WiFi credentials</span> <input id=persistent type=checkbox class="t-check" checked> <span class=toggle-switch></span> </label> </div><hr> <div class="btn-bar "> <a id=scan-wifi class="btn"> <div class=svg><svg id=svg-scan fill=currentColor viewBox="0 0 24 24"></svg></div><span>Scan WiFi networks</span> </a> <a id=connect-wifi class="btn"> <div class=svg><svg id=svg-connect fill=currentColor viewBox="0 0 24 24"></svg></div><span>Connect to <span id=ssid-name>SSID</span></span> </a> </div></div><div id="update-box" class="ctn opt-box hide"> <h2 class="heading-2">Update Firmware</h2> <form id=update-form class=form action="/update" method="post" enctype="multipart/form-data"> <label class="file"> <input type="file" id="file-input" aria-label="File browser"> <span class="file-custom"></span> </label> <a id=update-btn class=btn><span>Submit new firmware</span></a><br><p id=update-log style="text-align:center"></p></form> </div><div id=btn-box class="btn-bar hide"> <span class="toggle"><hr></span> <a id=restart class="btn"> <div class=svg><svg id=svg-restart fill=currentColor viewBox="0 0 24 24"></svg></div><span>Restart ESP</span> </a> <a id=save-params class="btn"> <div class=svg><svg id=svg-save fill=currentColor viewBox="0 0 24 24"></svg></div><span>Save configuration</span> </a> </div></main> <div class="loader hide" id=loader>Loading...</div><details id=modal-message> <summary></summary> <div class=d-modal> <a onclick=closeModalMessage()> <div class=d-modal-close> <svg id=svg-close-modal width=14 height=14 viewBox="0 0 14 14" fill=none></svg> </div></a> <div class=d-modal-title><h2 id=message-title>t</h2></div><div class=d-modal-content><p id=message-body></p></div><div class=btn-bar> <a id=ok-modal class="btn hide" onclick=closeModalMessage(true)><span>OK</span></a> <a id=close-modal class="btn" onclick=closeModalMessage(false)><span>Close</span></a> </div></div></details> <footer class=foot> <hr> <a id=about target=_blank rel=noopener href=https://github.com/cotestatnt/async-esp-fs-webserver>Created with https://github.com/cotestatnt/async-esp-fs-webserver</a> </footer>
<script>svgLogo='<svg width=128px height=128px viewBox="0 0 40 40"><path d="M 19.707,7.707 18.293,6.293 8.586,15.998 h 9.999 L 14.293,20.292 12,18 v 6 h 6 L 15.708,21.708 23.413,14 H 13.414 L 19.707,7.707 z M 15.999,0 C 7.164,0.002 0.002,7.164 0,15.999 0.002,24.837 7.164,31.999 15.999,32 24.837,31.998 31.999,24.837 32,15.999 31.999,7.164 24.837,0.002 15.999,0 z m 10.57,25.153 -4.861,-4.862 -1.417,1.417 4.862,4.861 c -2.454,2.127 -5.647,3.424 -9.154,3.43 C 8.267,29.986 2.015,23.733 2,15.999 2.007,12.494 3.304,9.3 5.432,6.847 l 3.861,3.86 1.413,-1.413 -3.86,-3.861 C 9.3,3.304 12.494,2.007 15.999,2 c 7.734,0.015 13.987,6.267 14,13.999 -0.006,3.506 -1.303,6.7 -3.43,9.154 z" /></svg>';const svgMenu='<path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>',svgLock='<svg height="16pt" viewBox="0 0 512 512"><path d="m336 512h-288c-26.453125 0-48-21.523438-48-48v-224c0-26.476562 21.546875-48 48-48h288c26.453125 0 48 21.523438 48 48v224c0 26.476562-21.546875 48-48 48zm-288-288c-8.8125 0-16 7.167969-16 16v224c0 8.832031 7.1875 16 16 16h288c8.8125 0 16-7.167969 16-16v-224c0-8.832031-7.1875-16-16-16zm0 0"/><path d="m304 224c-8.832031 0-16-7.167969-16-16v-80c0-52.929688-43.070312-96-96-96s-96 43.070312-96 96v80c0 8.832031-7.167969 16-16 16s-16-7.167969-16-16v-80c0-70.59375 57.40625-128 128-128s128 57.40625 128 128v80c0 8.832031-7.167969 16-16 16zm0 0"/></svg>',svgUnlock='<svg height="16pt" viewBox="0 0 512 512"><path d="m336 512h-288c-26.453125 0-48-21.523438-48-48v-224c0-26.476562 21.546875-48 48-48h288c26.453125 0 48 21.523438 48 48v224c0 26.476562-21.546875 48-48 48zm-288-288c-8.8125 0-16 7.167969-16 16v224c0 8.832031 7.1875 16 16 16h288c8.8125 0 16-7.167969 16-16v-224c0-8.832031-7.1875-16-16-16zm0 0"/><path d="m80 224c-8.832031 0-16-7.167969-16-16v-80c0-70.59375 57.40625-128 128-128s128 57.40625 128 128c0 8.832031-7.167969 16-16 16s-16-7.167969-16-16c0-52.929688-43.070312-96-96-96s-96 43.070312-96 96v80c0 8.832031-7.167969 16-16 16zm0 0"/></svg>',svgScan='<path d="M12 12C9.97 12 8.1 12.67 6.6 13.8L4.8 11.4C6.81 9.89 9.3 9 12 9S17.19 9.89 19.2 11.4L18.74 12C18.66 12 18.58 12 18.5 12C17.43 12 16.42 12.26 15.53 12.72C14.45 12.26 13.26 12 12 12M21 9L22.8 6.6C19.79 4.34 16.05 3 12 3S4.21 4.34 1.2 6.6L3 9C5.5 7.12 8.62 6 12 6S18.5 7.12 21 9M12 15C10.65 15 9.4 15.45 8.4 16.2L12 21L12.34 20.54C12.13 19.9 12 19.22 12 18.5C12 17.24 12.36 16.08 13 15.08C12.66 15.03 12.33 15 12 15M18 14.5C15.79 14.5 14 16.29 14 18.5S15.79 22.5 18 22.5C19.68 22.5 21.12 21.47 21.71 20H20C19.54 20.61 18.82 21 18 21C16.62 21 15.5 19.88 15.5 18.5S16.62 16 18 16C18.69 16 19.32 16.28 19.77 16.73L18 18.5H22V14.5L20.83 15.67C20.11 14.95 19.11 14.5 18 14.5Z" />',svgConnect='<path d="M12 6C8.62 6 5.5 7.12 3 9L1.2 6.6C4.21 4.34 7.95 3 12 3S19.79 4.34 22.8 6.6L21 9C18.5 7.12 15.38 6 12 6M16.84 13.41C17.18 13.27 17.55 13.17 17.92 13.1L19.2 11.4C17.19 9.89 14.7 9 12 9S6.81 9.89 4.8 11.4L6.6 13.8C8.1 12.67 9.97 12 12 12C13.78 12 15.44 12.5 16.84 13.41M12 15C10.65 15 9.4 15.45 8.4 16.2L12 21L13.04 19.61C13 19.41 13 19.21 13 19C13 17.66 13.44 16.43 14.19 15.43C13.5 15.16 12.77 15 12 15M23 19L20 16V18H16V20H20V22L23 19Z" />',svgSave='<path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" />',svgRestart='<path d="M12,4C14.1,4 16.1,4.8 17.6,6.3C20.7,9.4 20.7,14.5 17.6,17.6C15.8,19.5 13.3,20.2 10.9,19.9L11.4,17.9C13.1,18.1 14.9,17.5 16.2,16.2C18.5,13.9 18.5,10.1 16.2,7.7C15.1,6.6 13.5,6 12,6V10.6L7,5.6L12,0.6V4M6.3,17.6C3.7,15 3.3,11 5.1,7.9L6.6,9.4C5.5,11.6 5.9,14.4 7.8,16.2C8.3,16.7 8.9,17.1 9.6,17.4L9,19.4C8,19 7.1,18.4 6.3,17.6Z" />',svgEye='<path d="M12 6.5c2.76 0 5 2.24 5 5 0 .51-.1 1-.24 1.46l3.06 3.06c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l2.17 2.17c.47-.14.96-.24 1.47-.24zM2.71 3.16c-.39.39-.39 1.02 0 1.41l1.97 1.97C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.97-.3 4.31-.82l2.72 2.72c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L4.13 3.16c-.39-.39-1.03-.39-1.42 0zM12 16.5c-2.76 0-5-2.24-5-5 0-.77.18-1.5.49-2.14l1.57 1.57c-.03.18-.06.37-.06.57 0 1.66 1.34 3 3 3 .2 0 .38-.03.57-.07L14.14 16c-.65.32-1.37.5-2.14.5zm2.97-5.33c-.15-1.4-1.25-2.49-2.64-2.64l2.64 2.64z" />',svgNoEye='<path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>',svgCloseModal='<path fill-rule="evenodd" clip-rule="evenodd" d="M13.7071 1.70711C14.0976 1.31658 14.0976 0.683417 13.7071 0.292893C13.3166 -0.0976311 12.6834 -0.0976311 12.2929 0.292893L7 5.58579L1.70711 0.292893C1.31658 -0.0976311 0.683417 -0.0976311 0.292893 0.292893C-0.0976311 0.683417 -0.0976311 1.31658 0.292893 1.70711L5.58579 7L0.292893 12.2929C-0.0976311 12.6834 -0.0976311 13.3166 0.292893 13.7071C0.683417 14.0976 1.31658 14.0976 1.70711 13.7071L7 8.41421L12.2929 13.7071C12.6834 14.0976 13.3166 14.0976 13.7071 13.7071C14.0976 13.3166 14.0976 12.6834 13.7071 12.2929L8.41421 7L13.7071 1.70711Z" fill="black" />';var configFile,lastBox,ws,options={},$=function(_){return document.getElementById(_)},newEl=function(_){return document.createElement(_)};function ws_connect(){(ws=new WebSocket("ws://"+document.location.host+"/ws",["arduino"])).onopen=function(){ws.send("Connected - "+new Date)},ws.onmessage=function(_){$("update-log").innerHTML=_.data},ws.onclose=function(_){setTimeout(function(){ws_connect()},1e3)},ws.onerror=function(_){ws.close()}}function showHidePassword(){var _=$("password");"password"===_.type?(_.type="text",$("show-pass").classList.remove("w--current"),$("hide-pass").classList.add("w--current")):(_.type="password",$("show-pass").classList.add("w--current"),$("hide-pass").classList.remove("w--current"))}function getWiFiList(){$("loader").classList.remove("hide"),fetch(new URL(`http://${window.location.hostname}/scan`)).then(_=>_.json()).then(_=>{listWifiNetworks(_),$("loader").classList.add("hide")})}function selectWifi(_){try{$("select-"+_.target.parentNode.id).checked=!0}catch(e){$(_.target.id).checked=!0}$("ssid").value=this.cells[1].innerHTML,$("ssid-name").innerHTML=this.cells[1].innerHTML,$("password").focus()}function listWifiNetworks(_){let e=document.querySelector("#wifi-list");e.innerHTML="",_.forEach((_,t)=>{var s=newEl("tr"),i="wifi-"+t;s.id=i,s.addEventListener("click",selectWifi),s.innerHTML=`<td><input type="radio" name="select" id="select-${i}"></td>`,s.innerHTML+=`<td id="ssid-${i}">${_.ssid}</td>`,s.innerHTML+='<td class="hide-tiny">'+_.strength+" dBm</td>",_.security?s.innerHTML+='<td><svg height="16pt" viewBox="0 0 512 512"><path d="m336 512h-288c-26.453125 0-48-21.523438-48-48v-224c0-26.476562 21.546875-48 48-48h288c26.453125 0 48 21.523438 48 48v224c0 26.476562-21.546875 48-48 48zm-288-288c-8.8125 0-16 7.167969-16 16v224c0 8.832031 7.1875 16 16 16h288c8.8125 0 16-7.167969 16-16v-224c0-8.832031-7.1875-16-16-16zm0 0"/><path d="m304 224c-8.832031 0-16-7.167969-16-16v-80c0-52.929688-43.070312-96-96-96s-96 43.070312-96 96v80c0 8.832031-7.167969 16-16 16s-16-7.167969-16-16v-80c0-70.59375 57.40625-128 128-128s128 57.40625 128 128v80c0 8.832031-7.167969 16-16 16zm0 0"/></svg></td>':s.innerHTML+='<td><svg height="16pt" viewBox="0 0 512 512"><path d="m336 512h-288c-26.453125 0-48-21.523438-48-48v-224c0-26.476562 21.546875-48 48-48h288c26.453125 0 48 21.523438 48 48v224c0 26.476562-21.546875 48-48 48zm-288-288c-8.8125 0-16 7.167969-16 16v224c0 8.832031 7.1875 16 16 16h288c8.8125 0 16-7.167969 16-16v-224c0-8.832031-7.1875-16-16-16zm0 0"/><path d="m80 224c-8.832031 0-16-7.167969-16-16v-80c0-70.59375 57.40625-128 128-128s128 57.40625 128 128c0 8.832031-7.167969 16-16 16s-16-7.167969-16-16c0-52.929688-43.070312-96-96-96s-96 43.070312-96 96v80c0 8.832031-7.167969 16-16 16zm0 0"/></svg></td>',e.appendChild(s)}),$("wifi-table").classList.remove("hide")}function getEspStatus(){fetch(new URL(`http://${window.location.hostname}/wifistatus`)).then(_=>_.json()).then(_=>{$("esp-mode").innerHTML=_.mode,$("esp-ip").innerHTML=(255&_.ip)+"."+(_.ip>>8&255)+"."+(_.ip>>16&255)+"."+(_.ip>>>24),$("firmware").innerHTML=_.firmware})}function getParameters(){$("loader").classList.remove("hide");var _=new URL(`http://${window.location.hostname}/get_config`);fetch(_).then(_=>_.text()).then(e=>{configFile=e,fetch(_=new URL(`http://${window.location.hostname}`+configFile)).then(_=>_.json()).then(_=>{Object.keys(_).forEach(function(e){e.startsWith("logo-name")&&($("name-logo").innerHTML=_[e],delete _[e]),e.startsWith("logo-svg")&&($("svg-logo").innerHTML=_[e],delete _[e]),$("loader").classList.add("hide")}),listParameters(options=_),options["logo-file-hidden"]&&(svgLogo="",$("svg-logo").innerHTML='<img class=logo src="'+options["logo-file-hidden"]+'"/>',$("svg-logo").setAttribute("title",""),$("logo-file").setAttribute("type","number"))}).then(()=>{getEspStatus()})})}async function fetchFromFile(_,e){let t=await fetch(_,{method:e}),s=await t.text();return s}function createNewBox(_,e){var t=newEl("div");t.setAttribute("id","option-box"+_),t.classList.add("ctn","opt-box","hide");var s=newEl("h2");s.classList.add("heading-2"),s.innerHTML=e,t.appendChild(s);var i=newEl("form");i.classList.add("form"),t.appendChild(i),$("main-box").appendChild(t);var n=newEl("a");return n.setAttribute("id","set-opt"+_),n.setAttribute("data-box","option-box"+_),n.classList.add("a-link"),n.innerHTML=e,n.addEventListener("click",switchPage),$("nav-link").appendChild(n),t}async function listParameters(_){Object.keys(_)[0].startsWith("param-box")||(options=_={"param-box1":"Options",..._});var e,t=0;for(let s in _){t++;let i=_[s];if(s.startsWith("name-logo")){$("name-logo").innerHTML=value,document.title=value.replace(/(<([^>]+)>)/ig,"");continue}if(!s.startsWith("logo-file")){if(s.startsWith("param-box")){lastBox=createNewBox(t,i);continue}else if(s.startsWith("raw-css")){fetchFromFile(i,"HEAD").then(()=>{var _=newEl("link");_.setAttribute("rel","stylesheet"),_.setAttribute("href",i),document.head.appendChild(_)});continue}else if(s.startsWith("raw-javascript")){fetchFromFile(i,"HEAD").then(()=>{var _=newEl("script");_.setAttribute("src",i),document.body.appendChild(_)});continue}else if(s.startsWith("raw-html")){await fetchFromFile(i,"GET").then(_=>{(e=newEl("div")).setAttribute("id","row"+t),e.style.width="100%",e.innerHTML=_,lastBox.appendChild(e)});continue}else{let n=newEl("label");if((e=newEl("input")).setAttribute("id",s),e.setAttribute("type","text"),"boolean"==typeof i){e.setAttribute("type","checkbox"),e.classList.add("t-check","opt-input"),e.checked=i,n.classList.add("input-label","toggle");let a=newEl("div");a.classList.add("toggle-switch");let o=newEl("span");o.classList.add("toggle-label"),o.textContent=s,n.appendChild(e),n.appendChild(a),n.appendChild(o),addInputListener(e),lastBox.appendChild(n)}else{if(e.value=i,e.classList.add("opt-input"),n.setAttribute("label-for",s),n.classList.add("input-label"),n.textContent=s,"number"==typeof i&&e.setAttribute("type","number"),"object"==typeof i){if(i.values)(e=newEl("select")).setAttribute("id",s),i.values.forEach(_=>{var t=newEl("option");t.textContent=_,t.value=_,e.appendChild(t)}),e.value=i.selected,lastBox.appendChild(e);else{var d=Math.round(i.value*(1/i.step))/(1/i.step);e.setAttribute("type","number"),e.setAttribute("step",i.step),e.setAttribute("min",i.min),e.setAttribute("max",i.max),e.value=Number(d).toFixed(3)}}addInputListener(e);var c=newEl("div");c.classList.add("tf-wrapper"),c.appendChild(n),c.appendChild(e),lastBox.appendChild(c)}}s.endsWith("-hidden")&&e.classList.add("hide")}}}function addInputListener(_){if("number"===_.type){_.addEventListener("change",()=>{if(_.getAttribute("step")){var e={};e.value=Math.round(_.value*(1/_.step))/(1/_.step),e.step=_.getAttribute("step"),e.min=_.getAttribute("min"),e.max=_.getAttribute("max"),options[_.id]=e}else options[_.id]=parseInt(_.value)});return}if("text"===_.type){_.addEventListener("change",()=>{options[_.id]=_.value});return}if("checkbox"===_.type){_.addEventListener("change",()=>{options[_.id]=_.checked});return}if("select-one"===_.type){_.addEventListener("change",_=>{options[_.target.id].selected=_.target.value});return}}function saveParameters(){var _=new Blob([JSON.stringify(options,null,2)],{type:"application/json"}),e=new FormData;e.append("data",_,configFile),fetch("/edit",{method:"POST",body:e}).then(_=>_.text()).then(_=>{openModalMessage("Save options",'<br><b>"'+configFile+'"</b> saved successfully on flash memory!<br><br>')})}function doConnection(){var _=new FormData;_.append("ssid",$("ssid").value),_.append("password",$("password").value),_.append("persistent",$("persistent").checked),$("loader").classList.remove("hide"),fetch("/connect",{method:"POST",body:_,redirect:"follow"}).then(function(_){return httpCode=_.status,_.text()}).then(function(_){200===httpCode?openModalMessage("Connect to WiFi","<br>"+_):openModalMessage("Error!","<br>Error on connection: <b>"+_+"</b><br><br>"),$("loader").classList.add("hide")})}function switchPage(_){if($("top-nav").classList.remove("responsive"),document.querySelectorAll("a").forEach(_=>{_.classList.remove("active")}),_.target.classList.add("active"),document.querySelectorAll(".opt-box").forEach(_=>{_.classList.add("hide")}),$(_.target.getAttribute("data-box")).classList.remove("hide"),"set-wifi"!=_.target.id){var e=document.createDocumentFragment();e.appendChild($("btn-box")),$(_.target.getAttribute("data-box")).appendChild(e),$("btn-box").classList.remove("hide")}else $("btn-box").classList.add("hide")}function showMenu(){$("top-nav").classList.add("responsive")}var closeCallback=function(){};function openModalMessage(_,e,t){$("message-title").innerHTML=_,$("message-body").innerHTML=e,$("modal-message").open=!0,$("main-box").style.filter="blur(3px)",void 0!==t?(closeCallback=t,$("ok-modal").classList.remove("hide")):$("ok-modal").classList.add("hide")}function closeModalMessage(_){$("modal-message").open=!1,$("main-box").style.filter="",void 0!==closeCallback&&_&&closeCallback()}function restartESP(){fetch(new URL(`http://${window.location.hostname}/reset`)).then(_=>_.text()).then(_=>{closeModalMessage(),openModalMessage("Restart!","<br>ESP restarted. Please wait a little and then reload this page.<br>")})}function handleSubmit(){ws_connect(),$("loader").classList.remove("hide"),$("update-log").innerHTML="AGGIORNAMENTO IN CORSO";let _=$("file-input");if(0===_.files.length){alert("please choose a file");return}let e=_.files[0],t=new FormData;t.set("MD5","caf1eaeac27d3dd016118ad6a1434aca"),t.set("file",e),fetch("/update",{method:"POST",body:t}).then(_=>_.text()).then(_=>{$("update-log").innerHTML=_,$("loader").classList.add("hide"),ws.close()})}$("update-btn").addEventListener("click",handleSubmit),$("svg-menu").innerHTML='<path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>',$("svg-eye").innerHTML='<path d="M12 6.5c2.76 0 5 2.24 5 5 0 .51-.1 1-.24 1.46l3.06 3.06c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l2.17 2.17c.47-.14.96-.24 1.47-.24zM2.71 3.16c-.39.39-.39 1.02 0 1.41l1.97 1.97C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.97-.3 4.31-.82l2.72 2.72c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L4.13 3.16c-.39-.39-1.03-.39-1.42 0zM12 16.5c-2.76 0-5-2.24-5-5 0-.77.18-1.5.49-2.14l1.57 1.57c-.03.18-.06.37-.06.57 0 1.66 1.34 3 3 3 .2 0 .38-.03.57-.07L14.14 16c-.65.32-1.37.5-2.14.5zm2.97-5.33c-.15-1.4-1.25-2.49-2.64-2.64l2.64 2.64z" />',$("svg-no-eye").innerHTML='<path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>',$("svg-scan").innerHTML='<path d="M12 12C9.97 12 8.1 12.67 6.6 13.8L4.8 11.4C6.81 9.89 9.3 9 12 9S17.19 9.89 19.2 11.4L18.74 12C18.66 12 18.58 12 18.5 12C17.43 12 16.42 12.26 15.53 12.72C14.45 12.26 13.26 12 12 12M21 9L22.8 6.6C19.79 4.34 16.05 3 12 3S4.21 4.34 1.2 6.6L3 9C5.5 7.12 8.62 6 12 6S18.5 7.12 21 9M12 15C10.65 15 9.4 15.45 8.4 16.2L12 21L12.34 20.54C12.13 19.9 12 19.22 12 18.5C12 17.24 12.36 16.08 13 15.08C12.66 15.03 12.33 15 12 15M18 14.5C15.79 14.5 14 16.29 14 18.5S15.79 22.5 18 22.5C19.68 22.5 21.12 21.47 21.71 20H20C19.54 20.61 18.82 21 18 21C16.62 21 15.5 19.88 15.5 18.5S16.62 16 18 16C18.69 16 19.32 16.28 19.77 16.73L18 18.5H22V14.5L20.83 15.67C20.11 14.95 19.11 14.5 18 14.5Z" />',$("svg-connect").innerHTML='<path d="M12 6C8.62 6 5.5 7.12 3 9L1.2 6.6C4.21 4.34 7.95 3 12 3S19.79 4.34 22.8 6.6L21 9C18.5 7.12 15.38 6 12 6M16.84 13.41C17.18 13.27 17.55 13.17 17.92 13.1L19.2 11.4C17.19 9.89 14.7 9 12 9S6.81 9.89 4.8 11.4L6.6 13.8C8.1 12.67 9.97 12 12 12C13.78 12 15.44 12.5 16.84 13.41M12 15C10.65 15 9.4 15.45 8.4 16.2L12 21L13.04 19.61C13 19.41 13 19.21 13 19C13 17.66 13.44 16.43 14.19 15.43C13.5 15.16 12.77 15 12 15M23 19L20 16V18H16V20H20V22L23 19Z" />',$("svg-save").innerHTML='<path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" />',$("svg-restart").innerHTML='<path d="M12,4C14.1,4 16.1,4.8 17.6,6.3C20.7,9.4 20.7,14.5 17.6,17.6C15.8,19.5 13.3,20.2 10.9,19.9L11.4,17.9C13.1,18.1 14.9,17.5 16.2,16.2C18.5,13.9 18.5,10.1 16.2,7.7C15.1,6.6 13.5,6 12,6V10.6L7,5.6L12,0.6V4M6.3,17.6C3.7,15 3.3,11 5.1,7.9L6.6,9.4C5.5,11.6 5.9,14.4 7.8,16.2C8.3,16.7 8.9,17.1 9.6,17.4L9,19.4C8,19 7.1,18.4 6.3,17.6Z" />',$("svg-close-modal").innerHTML='<path fill-rule="evenodd" clip-rule="evenodd" d="M13.7071 1.70711C14.0976 1.31658 14.0976 0.683417 13.7071 0.292893C13.3166 -0.0976311 12.6834 -0.0976311 12.2929 0.292893L7 5.58579L1.70711 0.292893C1.31658 -0.0976311 0.683417 -0.0976311 0.292893 0.292893C-0.0976311 0.683417 -0.0976311 1.31658 0.292893 1.70711L5.58579 7L0.292893 12.2929C-0.0976311 12.6834 -0.0976311 13.3166 0.292893 13.7071C0.683417 14.0976 1.31658 14.0976 1.70711 13.7071L7 8.41421L12.2929 13.7071C12.6834 14.0976 13.3166 14.0976 13.7071 13.7071C14.0976 13.3166 14.0976 12.6834 13.7071 12.2929L8.41421 7L13.7071 1.70711Z" fill="black" />',$("svg-logo").innerHTML=svgLogo,$("svg-logo").setAttribute("title","Click to upload your logo file"),$("hum-btn").addEventListener("click",showMenu),$("scan-wifi").addEventListener("click",getWiFiList),$("connect-wifi").addEventListener("click",doConnection),$("save-params").addEventListener("click",saveParameters),$("show-hide-password").addEventListener("click",showHidePassword),$("set-wifi").addEventListener("click",switchPage),$("set-update").addEventListener("click",switchPage),$("about").addEventListener("click",switchPage),$("restart").addEventListener("click",restartESP),window.addEventListener("load",getParameters),$("connect-wifi").disabled=!0,$("password").addEventListener("input",_=>{0===$("password").value.length?$("connect-wifi").disabled=!0:$("connect-wifi").disabled=!1});</script>
</body>
</html>