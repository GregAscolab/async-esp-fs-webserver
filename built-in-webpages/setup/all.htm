<!DOCTYPE html>
<html>
<head>
<meta charset=utf-8>
<title>Async ESP FS WebServerr</title>
<meta content="width=device-width, initial-scale=1" name=viewport>
<style>
  .loader,.loader:before,.loader:after{border-radius:50%;width:2em;height:2em;-webkit-animation-fill-mode:both;animation-fill-mode:both;-webkit-animation:load7 1.8s infinite ease-in-out;animation:load7 1.8s infinite ease-in-out}.loader{color:#333;font-size:10px;margin-left:auto;margin-right:auto;position:relative;text-indent:-9999em;z-index:999;-webkit-transform:translateZ(0);-ms-transform:translateZ(0);transform:translateZ(0);-webkit-animation-delay:-0.16s;animation-delay:-0.16s}.loader:before,.loader:after{content:'';position:absolute;top:0}.loader:before{left:-4.5em;-webkit-animation-delay:-0.32s;animation-delay:-0.32s}.loader:after{left:4.5em}.progress-wrap{text-align:center;position:relative;width:60%;height:25px;margin:20px auto;background:#9e9e9e7d;font-size:20px;transition:all .4s ease}.progress-wrap:not(.active){cursor:pointer;background:#9e9e9e00}.progress-wrap .progress{width:0;z-index:5;background:#9e9e9ea1;opacity:0;transition:all .3s ease}.progress-wrap.active .progress{opacity:1;animation:progress-anim 10s ease 0s}.progress-wrap[data-progress-style='fill-back'] .progress{position:absolute;left:0;top:0;right:0;bottom:0}.d-modal{border-radius:10px;border-style:solid;border-width:1px;border-color:#3333336e;background-color:hsl(199.53deg 18.3% 46.08% / 90%);box-shadow:rgba(0,0,0,0.24) 0 3px 8px;left:50%;position:absolute;top:50%;transform:translate(-50%,-50%);flex-direction:column}.d-modal-title{color:#111827;padding:1.5em;position:relative;width:calc(100% - 4.5em)}.d-modal-content{border-top:1px solid #e0e0e0;padding:1.5em;overflow:auto}.topnav{background-color:#333;overflow:hidden;width:fit-content;float:right;border-radius:5px;position:absolute;bottom:5px;right:20px}.topnav a{float:left;display:block;color:#f2f2f2;text-align:center;padding:5px 10px;text-decoration:none;font-size:16px}.topnav a:hover{filter:brightness(55%);cursor:pointer}.topnav a.active{background-color:#56c080;color:white}.topnav .icon{display:none}.logo{width:100%}.lbl-wifi{text-align:center}.table{width:90%;margin:auto;border-collapse:collapse;border-spacing:0}.svg{display:flex;width:20px;margin-right:10px}.svg-e{margin-top:5px}.body{padding-right:20px;padding-left:20px;border-radius:10px;background-color:darkslategray;background-clip:border-box}.output{color:white}.title{display:flex;justify-content:center;float:left}.heading-2{padding-right:20px;padding-left:20px;font-weight:400;text-align:center}.form{padding:20px;width:75%;text-align:center}.ctn:before,.ctn:after{content:" ";display:table;grid-column-start:1;grid-row-start:1;grid-column-end:2;grid-row-end:2}.ctn:after{clear:both}.ctn{display:block;max-width:940px;margin:10px auto 10px auto;padding:10px 40px;clear:both;flex-direction:row;justify-content:center;flex-wrap:wrap;align-items:center;align-content:space-around;border-radius:10px;border-style:solid;border-width:1px;border-color:#3333336e;background-color:hsla(0,0%,100%,0.8);box-shadow:rgba(0,0,0,0.24) 0 3px 8px;position:relative}.btn-bar{display:flex;margin-top:20px;padding:20px;justify-content:center;flex-wrap:wrap;grid-column-gap:30px;grid-row-gap:20px}.tf-wrapper{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;margin-bottom:12px;flex-direction:column;align-items:center}.show-hide{max-width:100%;display:flex;background-color:#fff;font-size:13.5px}.show-hide-wrap{position:absolute;left:auto;top:40%;right:4%;bottom:auto;z-index:4;cursor:pointer}.heading{margin-right:10px;margin-left:10px}.hide,.show-hide.w--current{display:none}.toggle{cursor:pointer;display:inline-block;padding:5px;width:100%;margin:0 0 18px -8px}.toggle-switch{display:inline-block;background:#ccc;border-radius:16px;width:58px;height:32px;position:relative;vertical-align:middle;transition:background .25s}.toggle-switch:before,.toggle-switch:after{content:""}.toggle-switch:before{display:block;background:linear-gradient(to bottom,#fff 0,#eee 100%);border-radius:50%;box-shadow:0 0 0 1px rgba(0,0,0,0.25);width:24px;height:24px;position:absolute;top:4px;left:4px;transition:left .25s}.toggle:hover .toggle-switch:before{background:linear-gradient(to bottom,#fff 0,#fff 100%);box-shadow:0 0 0 1px rgba(0,0,0,0.5)}.t-check:checked+.toggle-switch{background:#56c080}.t-check:checked+.toggle-switch:before{left:30px}.t-check{position:absolute;visibility:hidden}.toggle-label{margin-left:5px;position:relative;top:2px}tr:hover{filter:brightness(85%)}html{font-family:sans-serif}details,header,main,summary{display:block}a{background-color:transparent}a:active,a:hover{outline:0}b{font-weight:700}h1{font-size:36px}h2{font-size:24px}hr{padding:0}.input-label{color:#015293;position:relative;left:5%;bottom:-7px;padding-right:7px;padding-left:6px;border-style:solid;border-width:1px;border-color:#dcdce5;border-radius:6px;background-color:#fff;font-size:13.5px;line-height:18px;align-self:self-start}input:-webkit-autofill,input:-webkit-autofill:hover,input:-webkit-autofill:focus,input:-webkit-autofill:active{-webkit-box-shadow:0 0 0 30px #fff inset!important}input[type='checkbox']{box-sizing:border-box;padding:0}input[type='text'],input[type='number'],input[type='password'],select{height:30px;width:90%;padding-top:10px;padding-left:20px;border:1px solid #ccc;border-radius:6px;box-shadow:0 1px 2px 0 rgba(220,220,230,0.5);transition:border-color 200ms ease,box-shadow 200ms ease;font-size:16px}input[type=file]{display:none}input::placeholder{color:#5e5e5e}input:hover{border-color:rgba(0,0,0,0.8);box-shadow:0 1px 4px 0 rgba(220,220,229,0.9)}input:focus,select:focus{border-color:#3898ec;outline:0}input[type=number]:hover::-webkit-inner-spin-button{-webkit-appearance:none;-moz-appearance:textfield}footer{text-align:center;font-size:12px;margin:40px}button,.btn{display:inline-flex;padding:10px 15px;background-color:#3898ec;color:#fff;border:0;cursor:pointer;min-width:40%;border-radius:5px;justify-content:center}button:hover,.btn:hover{filter:brightness(85%)}.firmware{display:flex;justify-content:center}.fw-upload{display:inline-block;padding:10px 20px;cursor:pointer;border-radius:5px;margin-right:20px;background:dimgray;color:#fff}.fw-upload:hover{filter:brightness(85%)}.btn,.submit{min-width:30%}#about{color:lightgray}@media screen and (max-width:991px){.ctn{max-width:728px}.ctn{position:relative;overflow:visible;max-width:95%;padding-right:20px;padding-left:20px;grid-column-gap:10px;grid-row-gap:10px;object-fit:contain}.wifi-connect{padding-right:20px;padding-left:20px}}@media screen and (max-width:767px){.wifi-connect{padding-right:10px;padding-left:10px}}@media screen and (max-width:608px){h1{font-size:24px}.btn-bar{margin-top:20px;flex-direction:column}.topnav{margin-bottom:5px;width:-webkit-fill-available;max-width:60%}.topnav a{padding:5px 20px}.topnav a:not(.active){display:none}.topnav a.icon{float:right;display:block}.topnav.responsive .icon{position:absolute;right:0;top:0}.topnav.responsive a{float:none;display:block;text-align:left}.hide-tiny{display:none}}@media screen and (max-width:479px){.body{padding-right:2px;padding-left:2px}.heading-2{margin-top:10px;padding-right:0;padding-left:0}.form{padding:0}.ctn{max-width:100%;padding:0 10px 0 10px}}
</style>
</head>
<body class=body>
<main id=main-box>
<header class="ctn header">
<div class=title>
<div id=img-logo title='Click to upload your logo file'></div>
<h1 id=name-logo class=heading>Async ESP FS WebServer</h1>
</div>
<div class=topnav id=top-nav>
<span id=nav-link><a id=set-wifi class="a-link active" data-box=wifi-box>WiFi Setup</a></span>
<span id=upd-link><a id=set-update class=a-link data-box=update-box>Update</a></span>
<a class="a-link icon" id=hum-btn>
<div class=svg style=margin:-2px>
<svg id=svg-menu height=16pt fill=currentColor viewBox="0 0 20 18"></svg>
</div>
</a>
</div>
</header>
<div id=wifi-box class="ctn opt-box">
<h2 class=heading-2>Connect to WiFi</h2>
<div style=text-align:center>ESP mode: <b>
<span id=esp-mode></span></b>, IP address: <b>
<span id=esp-ip></span></b>, Firmware: <span id=firmware></span>
</div>
<div id=wifi-table class=hide>
<hr>
<table class=table>
<tbody id=wifi-list></tbody>
</table>
<br>
</div>
<div id=wifi>
<div class=tf-wrapper>
<label for=ssid class=input-label>SSID</label>
<input type=text placeholder="Enter your WiFI SSID name" id=ssid>
</div>
<div class=tf-wrapper>
<label for=password class=input-label>Password</label>
<div class=show-hide-wrap id=show-hide-password>
<a class="show-hide w--current" id=show-pass>
<div class=svg><svg class=svg-e id=svg-eye viewBox="0 0 24 24"></svg></div>
</a>
<a class=show-hide id=hide-pass>
<div class=svg><svg class=svg-e id=svg-no-eye viewBox="0 0 24 24"></svg></div>
</a>
</div>
<input type=password placeholder="Enter your WiFi password" id=password autocomplete=current-password data-ms-member=password>
</div>
<label class="toggle lbl-wifi">
<span class=toggle-label>Store WiFi credentials</span>
<input id=persistent type=checkbox class=t-check checked>
<span class=toggle-switch></span>
</label>
</div>
<hr>
<div class=btn-bar>
<a id=scan-wifi class=btn>
<div class=svg><svg id=svg-scan fill=currentColor viewBox="0 0 24 24"></svg></div>
<span>Scan WiFi networks</span>
</a>
<a id=connect-wifi class=btn>
<div class=svg><svg id=svg-connect fill=currentColor viewBox="0 0 24 24"></svg></div>
<span>Connect to <span id=ssid-name>SSID</span></span>
</a>
</div>
</div>
<div id=update-box class="ctn opt-box hide">
<h2 class=heading-2>Update Firmware</h2>
<div class=tf-wrapper>
<form id=update-form class=form action=/update method=post enctype=multipart/form-data>
<div class=firmware>
<label for=file-input id=fw-label class=fw-upload>Select firmware binary file</label>
<input id=file-input type="file"/>
<a id=update-btn class="btn submit">
<div class=svg><svg fill=currentColor viewBox="0 0 24 24"><path d=M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z /></svg></div>
<span>Submit!</span>
</a><br>
</div>
<div class=progress-wrap id=progress-wrap data-progress-style=fill-back>
<div id=update-log></div>
<div class=progress id=progress-anim></div>
</div>
</form>
</div>
</div>
<div id=btn-box class="btn-bar hide">
<span><hr></span>
<a id=restart class=btn>
<div class=svg><svg id=svg-restart fill=currentColor viewBox="0 0 24 24"></svg></div>
<span>Restart ESP</span>
</a>
<a id=save-params class=btn>
<div class=svg><svg id=svg-save fill=currentColor viewBox="0 0 24 24"></svg></div>
<span>Save configuration</span>
</a>
</div>
</main>
<div class="loader hide" id=loader>Loading...</div>
<details id=modal-message>
<summary></summary>
<div class=d-modal>
<div class=d-modal-title><h2 id=message-title>t</h2></div>
<div class=d-modal-content><p id=message-body></p></div>
<div class=btn-bar>
<a id=ok-modal class="btn hide" onclick=closeModalMessage(true)><span>OK</span></a>
<a id=close-modal class=btn onclick=closeModalMessage(false)><span>Close</span></a>
</div>
</div>
</details>
<footer class=foot>
<hr>
<a id=about target=_blank rel=noopener href=https://github.com/cotestatnt/async-esp-fs-webserver>Created with https://github.com/cotestatnt/async-esp-fs-webserver</a>
</footer>
<script>svgLogo='<svg height=120px viewBox="0 0 200 200"><path d="M47.1,106.3c0,5.5-4.5,10-10,10c-5.5,0-10-4.5-10-10c0-5.5,4.5-10,10-10C42.6,96.3,47.1,100.8,47.1,106.3" transform="matrix(1, 0, 0, 1, 3.552713678800501e-15, 3.552713678800501e-15)"/><path d="M134.8,95.9C128.4,50.2,92.1,14,46.5,7.5c-5.3,2.8-10.2,6.4-14.6,10.5v9.7c45.6,0,82.6,37.1,82.6,82.6h9.7 C128.4,106.1,132,101.2,134.8,95.9" transform="matrix(1, 0, 0, 1, 3.552713678800501e-15, 3.552713678800501e-15)"/><path d="M142.3,65.4C142.3,29.3,113.1,0,77,0c-2.3,0-4.5,0.1-6.7,0.4l-1.5,4.3c32.1,11.2,57.6,36.7,68.9,68.8L142,72 C142.2,69.8,142.3,67.6,142.3,65.4" transform="matrix(1, 0, 0, 1, 3.552713678800501e-15, 3.552713678800501e-15)"/><path d="M77.7,143c-20.8,0-40.3-8.1-54.9-22.8C8.1,105.6,0,86.1,0,65.3C0,44.5,8.1,25,22.8,10.3l4.1,4.2 c-13.6,13.6-21,31.6-21,50.8s7.5,37.2,21,50.8c13.6,13.6,31.6,21,50.8,21c19.2,0,37.2-7.5,50.8-21l4.2,4.1 C118,134.9,98.5,143,77.7,143" transform="matrix(1, 0, 0, 1, 3.552713678800501e-15, 3.552713678800501e-15)"/><path d="M76.9,114.9c1.6-16.2-5.6-31.3-17.7-40.5c-6.4-4.8-14.2-8.1-22.7-8.9c-2.2-0.2-3.9-2.2-3.6-4.4 c0.3-2.4,2.3-3.9,4.4-3.6c9.3,0.9,17.8,4.2,24.9,9.2c15.4,10.7,24.8,29.2,22.8,49.1c-0.3,3.2-0.9,6.2-1.8,9.2l11.8,3.3 c3.5-1,7-2.3,10.2-3.8c0.8-4.5,1.3-9.2,1.3-14c0-37.4-27.6-68.4-63.6-73.7c-4.3-0.6-8.7-0.7-11.9,0.1c-5.1,1.3-9.5,4.1-12.9,7.9 c-4,4.5-6.3,10.4-6.3,16.8c0,11.4,7.4,21,17.7,24.3c1.9,0.6,4.9,0.9,6.4,1.1H36c11.2,1.9,19.8,11.8,19.8,23.5 c0,4.7-1.4,9.1-3.8,12.9l8.2,5.2c3.9,1,8,1.7,12.2,2C74.7,125.8,76.3,120.5,76.9,114.9" transform="matrix(1, 0, 0, 1, 3.552713678800501e-15, 3.552713678800501e-15)"/></svg>';const svgLock='<svg height="16pt" viewBox="0 0 24 24"><path d="M12,17A2,2 0 0,0 14,15C14,13.89 13.1,13 12,13A2,2 0 0,0 10,15A2,2 0 0,0 12,17M18,8A2,2 0 0,1 20,10V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V10C4,8.89 4.9,8 6,8H7V6A5,5 0 0,1 12,1A5,5 0 0,1 17,6V8H18M12,3A3,3 0 0,0 9,6V8H15V6A3,3 0 0,0 12,3Z" /></svg>';const svgUnlock='<svgheight="16pt" viewBox="0 0 24 24"><path d="M18 1C15.24 1 13 3.24 13 6V8H4C2.9 8 2 8.89 2 10V20C2 21.11 2.9 22 4 22H16C17.11 22 18 21.11 18 20V10C18 8.9 17.11 8 16 8H15V6C15 4.34 16.34 3 18 3C19.66 3 21 4.34 21 6V8H23V6C23 3.24 20.76 1 18 1M10 13C11.1 13 12 13.89 12 15C12 16.11 11.11 17 10 17C8.9 17 8 16.11 8 15C8 13.9 8.9 13 10 13Z" /></svg>';const svgScan='<path d="M12 20L8.4 15.2C9.4 14.45 10.65 14 12 14S14.6 14.45 15.6 15.2L12 20M4.8 10.4L6.6 12.8C8.1 11.67 9.97 11 12 11S15.9 11.67 17.4 12.8L19.2 10.4C17.19 8.89 14.7 8 12 8S6.81 8.89 4.8 10.4M12 2C7.95 2 4.21 3.34 1.2 5.6L3 8C5.5 6.12 8.62 5 12 5S18.5 6.12 21 8L22.8 5.6C19.79 3.34 16.05 2 12 2M7 24H9V22H7V24M15 24H17V22H15V24M11 24H13V22H11V24Z" /></svg>';const svgConnect='<path d="M12,6C8.6,6 5.5,7.1 3,9L1.2,6.6C4.2,4.3 8,3 12,3C16,3 19.8,4.3 22.8,6.6L21,9C18.5,7.1 15.4,6 12,6M13,19C13,17.7 13.4,16.4 14.2,15.4C13.5,15.2 12.8,15 12,15C10.7,15 9.4,15.5 8.4,16.2L12,21L13,19.6C13,19.4 13,19.2 13,19M16.8,13.4C17.1,13.3 17.5,13.2 17.9,13.1L19.2,11.4C17.2,9.9 14.7,9 12,9C9.3,9 6.8,9.9 4.8,11.4L6.6,13.8C8.1,12.7 10,12 12,12C13.8,12 15.4,12.5 16.8,13.4M16.5,22.6L17.2,19.8L15,17.9L17.9,17.7L19,15L20.1,17.6L23,17.8L20.8,19.7L21.5,22.5L19,21.1L16.5,22.6Z" /></svg>';const svgSave='<path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z" />';const svgRestart='<path d="M12,4C14.1,4 16.1,4.8 17.6,6.3C20.7,9.4 20.7,14.5 17.6,17.6C15.8,19.5 13.3,20.2 10.9,19.9L11.4,17.9C13.1,18.1 14.9,17.5 16.2,16.2C18.5,13.9 18.5,10.1 16.2,7.7C15.1,6.6 13.5,6 12,6V10.6L7,5.6L12,0.6V4M6.3,17.6C3.7,15 3.3,11 5.1,7.9L6.6,9.4C5.5,11.6 5.9,14.4 7.8,16.2C8.3,16.7 8.9,17.1 9.6,17.4L9,19.4C8,19 7.1,18.4 6.3,17.6Z" /></svg>';const svgEye='<path d="M12 6.5c2.76 0 5 2.24 5 5 0 .51-.1 1-.24 1.46l3.06 3.06c1.39-1.23 2.49-2.77 3.18-4.53C21.27 7.11 17 4 12 4c-1.27 0-2.49.2-3.64.57l2.17 2.17c.47-.14.96-.24 1.47-.24zM2.71 3.16c-.39.39-.39 1.02 0 1.41l1.97 1.97C3.06 7.83 1.77 9.53 1 11.5 2.73 15.89 7 19 12 19c1.52 0 2.97-.3 4.31-.82l2.72 2.72c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L4.13 3.16c-.39-.39-1.03-.39-1.42 0zM12 16.5c-2.76 0-5-2.24-5-5 0-.77.18-1.5.49-2.14l1.57 1.57c-.03.18-.06.37-.06.57 0 1.66 1.34 3 3 3 .2 0 .38-.03.57-.07L14.14 16c-.65.32-1.37.5-2.14.5zm2.97-5.33c-.15-1.4-1.25-2.49-2.64-2.64l2.64 2.64z" />';const svgNoEye='<path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>';const svgMenu='<path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>';var options={};var configFile;var lastBox;var $=function(el){return document.getElementById(el);};var newEl=function(el){return document.createElement(el);};function showHidePassword(){var inp=$("password");if(inp.type==="password"){inp.type="text";$('show-pass').classList.remove("w--current");$('hide-pass').classList.add("w--current");}
else{inp.type="password";$('show-pass').classList.add("w--current");$('hide-pass').classList.remove("w--current");}}
function getWiFiList(){$('loader').classList.remove('hide');var url=new URL("http://"+`${window.location.hostname}`+"/scan");fetch(url).then(response=>response.json()).then(data=>{listWifiNetworks(data);$('loader').classList.add('hide');});}
function selectWifi(row){try{$('select-'+row.target.parentNode.id).checked=true;}
catch(err){$(row.target.id).checked=true;}
$('ssid').value=this.cells[1].innerHTML;$('ssid-name').innerHTML=this.cells[1].innerHTML;$('password').focus();}
function listWifiNetworks(elems){const list=document.querySelector('#wifi-list');list.innerHTML="";elems.forEach((elem,idx)=>{var row=newEl('tr');var id='wifi-'+idx;row.id=id;row.addEventListener('click',selectWifi);row.innerHTML=`<td><input type="radio"name="select"id="select-${id}"></td>`;row.innerHTML+=`<td id="ssid-${id}">${elem.ssid}</td>`;row.innerHTML+='<td class="hide-tiny">'+elem.strength+' dBm</td>';if(elem.security)
row.innerHTML+='<td>'+svgLock+'</td>';else
row.innerHTML+='<td>'+svgUnlock+'</td>';list.appendChild(row);});$("wifi-table").classList.remove("hide");}
function getEspStatus(){var url=new URL("http://"+`${window.location.hostname}`+"/wifistatus");fetch(url).then(response=>response.json()).then(data=>{$('esp-mode').innerHTML=data.mode;$('esp-ip').innerHTML=(data.ip&255)+'.'+(data.ip>>8&255)+'.'+(data.ip>>16&255)+'.'+(data.ip>>>24);$('firmware').innerHTML=data.firmware;});}
async function fetchFromFile(f,m){const response=await fetch(f,{method:m});const data=await response.text();return data;}
function getParameters(){$('loader').classList.remove('hide');var url=new URL("http://"+`${window.location.hostname}`+'/get_config');fetch(url).then(res=>res.text()).then(config=>{configFile=config;url=new URL("http://"+`${window.location.hostname}`+configFile);fetch(url).then(response=>response.json()).then(data=>{for(const key in data){if(data.hasOwnProperty(key)){if(key==='name-logo'){$('name-logo').innerHTML=data[key].replace(/(<([^>]+)>)/ig,'');delete data[key];continue;}
if(key=='img-logo'){fetch(data[key]).then((response)=>response.text()).then((base64)=>{var size=data[key].replace(/[^\d_]/g,'').split('_');var img=newEl('img');img.classList.add('logo');img.setAttribute('src','data:image/png;base64, '+base64);img.setAttribute('style',`width:${size[0]}px;heigth:${size[1]}px`);$('img-logo').innerHTML="";$('img-logo').append(img);$('img-logo').setAttribute('type','number');$('img-logo').setAttribute('title','');delete data[key];})
continue;}}}
options=data;listParameters(options);$('loader').classList.add('hide');}).then(()=>{getEspStatus();});});}
function createNewBox(cont,lbl){var box=newEl('div');box.setAttribute('id','option-box'+cont);box.classList.add('ctn','opt-box','hide');var h=newEl('h2');h.classList.add('heading-2');h.innerHTML=lbl;box.appendChild(h);$('main-box').appendChild(box);var lnk=newEl('a');lnk.setAttribute('id','set-opt'+cont);lnk.setAttribute('data-box','option-box'+cont);lnk.classList.add('a-link');lnk.innerHTML=lbl;lnk.addEventListener('click',switchPage);$('nav-link').appendChild(lnk);return box;}
async function listParameters(params){var el;if(!Object.keys(params)[0].startsWith('param-box')){params={'param-box1':'Options',...params};options=params;}
var i=0;for(const key in params){i++;if(key.startsWith('param-box')){lastBox=createNewBox(i,params[key]);continue;}
else if(key.startsWith('raw-css')){fetchFromFile(params[key],'HEAD').then(()=>{var css=newEl("link");css.setAttribute('rel','stylesheet');css.setAttribute('href',params[key]);document.head.appendChild(css);delete params[key];});continue;}
else if(key.startsWith('raw-javascript')){fetchFromFile(params[key],'HEAD').then(()=>{var js=newEl("script");js.setAttribute('src',params[key]);document.body.appendChild(js);delete params[key];});continue;}
else if(key.startsWith('raw-html')){await fetchFromFile(params[key],'GET').then((res)=>{el=newEl('div');el.setAttribute('id','row'+i)
el.style.width='100%';el.innerHTML=res;lastBox.appendChild(el);});continue;}
else{let lbl=newEl('label');el=newEl('input');el.setAttribute('id',key);el.setAttribute('type','text');if(typeof(params[key])==="boolean"){el.setAttribute('type','checkbox');el.classList.add('t-check','opt-input');el.checked=params[key];lbl.classList.add('input-label','toggle');let dv=newEl('div');dv.classList.add('toggle-switch');let sp=newEl('span');sp.classList.add('toggle-label');sp.textContent=key;lbl.appendChild(el);lbl.appendChild(dv);lbl.appendChild(sp);addInputListener(el);lastBox.appendChild(lbl);}
else{el.value=params[key];el.classList.add('opt-input');lbl.setAttribute('label-for',key);lbl.classList.add('input-label');lbl.textContent=key;if(typeof(params[key])==="number")
el.setAttribute('type','number');if(typeof(params[key])==="object"){if(params[key].values){el=newEl('select');el.setAttribute('id',key);params[key].values.forEach((a)=>{var opt=newEl('option');opt.textContent=a;opt.value=a;el.appendChild(opt);})
el.value=params[key].selected;lastBox.appendChild(el);}
else{var num=Math.round(params[key].value*(1/params[key].step))/(1/params[key].step);el.setAttribute('type','number');el.setAttribute('step',params[key].step);el.setAttribute('min',params[key].min);el.setAttribute('max',params[key].max);el.value=Number(num).toFixed(3);}}
addInputListener(el);var d=newEl('div');d.classList.add('tf-wrapper');d.appendChild(lbl);d.appendChild(el);lastBox.appendChild(d);}}
if(key.endsWith('-hidden')){el.classList.add('hide');}}}
function addInputListener(item){if(item.type==="number"){item.addEventListener('change',()=>{if(item.getAttribute("step")){var obj={};obj.value=Math.round(item.value*(1/item.step))/(1/item.step);obj.step=item.getAttribute("step");obj.min=item.getAttribute("min");obj.max=item.getAttribute("max");options[item.id]=obj;}
else
options[item.id]=parseInt(item.value);});return;}
if(item.type==="text"){item.addEventListener('change',()=>{options[item.id]=item.value;});return;}
if(item.type==="checkbox"){item.addEventListener('change',()=>{options[item.id]=item.checked;});return;}
if(item.type==='select-one'){item.addEventListener('change',(e)=>{options[e.target.id].selected=e.target.value;});return;}}
function saveParameters(){var myblob=new Blob([JSON.stringify(options,null,2)],{type:'application/json'});var formData=new FormData();formData.append("data",myblob,configFile);fetch('/edit',{method:'POST',body:formData}).then(response=>response.text()).then(text=>{openModalMessage('Save options','<br><b>"'+configFile+'"</b> saved successfully on flash memory!<br><br>');});}
function doConnection(){var formdata=new FormData();formdata.append("ssid",$('ssid').value);formdata.append("password",$('password').value);formdata.append("persistent",$('persistent').checked);var requestOptions={method:'POST',body:formdata,redirect:'follow'};$('loader').classList.remove('hide');fetch('/connect',requestOptions).then(function(response){httpCode=response.status;return response.text();}).then(function(text){if(httpCode===200){openModalMessage('Connect to WiFi','<br>'+text+'');}
else{openModalMessage('Error!','<br>Error on connection: <b>'+text+'</b><br><br>');}
$('loader').classList.add('hide');});}
function switchPage(el){$('top-nav').classList.remove('responsive');document.querySelectorAll("a").forEach(item=>{item.classList.remove('active');});el.target.classList.add('active');document.querySelectorAll(".opt-box").forEach(e=>{e.classList.add('hide');});$(el.target.getAttribute("data-box")).classList.remove('hide');if(el.target.id!='set-wifi'){var fragment=document.createDocumentFragment();fragment.appendChild($('btn-box'));$(el.target.getAttribute("data-box")).appendChild(fragment);$('btn-box').classList.remove('hide');}
else
$('btn-box').classList.add('hide');}
function showMenu(){$('top-nav').classList.add('responsive');}
var closeCallback=function(){;};function openModalMessage(title,msg,fn){$('message-title').innerHTML=title;$('message-body').innerHTML=msg;$('modal-message').open=true;$('main-box').style.filter="blur(3px)";if(typeof fn!='undefined'){closeCallback=fn;$('ok-modal').classList.remove('hide');}
else
$('ok-modal').classList.add('hide');}
function closeModalMessage(do_cb){$('modal-message').open=false;$('main-box').style.filter="";if(typeof closeCallback!='undefined'&&do_cb)
closeCallback();}
function restartESP(){var url=new URL("http://"+`${window.location.hostname}`+"/reset");fetch(url).then(response=>response.text()).then(data=>{closeModalMessage();openModalMessage('Restart!','<br>ESP restarted. Please wait a little and then reload this page.<br>');});}
function handleSubmit(){let fileElement=$('file-input');if(fileElement.files.length===0){alert('please choose a file');return;}
var update=$('update-log');var loader=$('loader');var prg=$('progress-wrap');loader.classList.remove('hide');prg.classList.add('active')
update.innerHTML='Update in progress';let formData=new FormData();formData.set('update',fileElement.files[0]);var fsize=fileElement.files[0].size;var req=new XMLHttpRequest();req.open('POST','/update?size='+fsize);req.onload=function(d){loader.classList.add('hide');prg.classList.remove('active');if(req.status!=200)
update.innerHTML=`Error ${req.status}:${req.statusText}`;else
update.innerHTML=req.response;};req.upload.addEventListener('progress',(p)=>{let w=Math.round(p.loaded/p.total*100)+'%';if(p.lengthComputable){$('progress-anim').style.width=w;update.innerHTML='Update in progress: '+w;}});req.send(formData);}
$('svg-menu').innerHTML=svgMenu;$('svg-eye').innerHTML=svgEye;$('svg-no-eye').innerHTML=svgNoEye;$('svg-scan').innerHTML=svgScan;$('svg-connect').innerHTML=svgConnect;$('svg-save').innerHTML=svgSave;$('svg-restart').innerHTML=svgRestart;$('img-logo').innerHTML=svgLogo;$('hum-btn').addEventListener('click',showMenu);$('scan-wifi').addEventListener('click',getWiFiList);$('connect-wifi').addEventListener('click',doConnection);$('save-params').addEventListener('click',saveParameters);$('show-hide-password').addEventListener('click',showHidePassword);$('set-wifi').addEventListener('click',switchPage);$('set-update').addEventListener('click',switchPage);$('about').addEventListener('click',switchPage);$('restart').addEventListener('click',restartESP);$('update-btn').addEventListener('click',handleSubmit);$('file-input').addEventListener('change',()=>{$('fw-label').innerHTML=$('file-input').files.item(0).name+' ('+$('file-input').files.item(0).size+' bytes)';$('fw-label').style.background='brown';});window.addEventListener('load',getParameters);$('connect-wifi').disabled=true;$('password').addEventListener('input',(event)=>{if($('password').value.length===0)
$('connect-wifi').disabled=true;else
$('connect-wifi').disabled=false;});</script>
</body>
</html>